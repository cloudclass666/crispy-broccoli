/*
Plugin Name: SM.MS图床外链小工具
Plugin URI: https://www.qcgzxw.cn/2555.html
Description: 小文博客独自开发的图床插件，用于WordPress博客添加 图床上传小工具、评论处图片上传按钮、文章编辑处图片上传按钮。
Author: 小文博客
Author URI: https://www.qcgzxw.cn/
Version: 4.2
License: GPL version 2 or later - http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
自定义小工具CSS样式部分
*/
$('#zz-img-file').change(function(){for(var i=0;i<this.files.length;i++){var f=this.files[i];var formData=new FormData();formData.append('smfile',f);$.ajax({url:'/index.php/wp-json/smms/api/v2/upload',type:'POST',processData:false,contentType:false,data:formData,beforeSend:function(xhr){$('#zz-img-add').text('Uploading...')},success:function(res){$("#zz-img-add").text('上传图片');$('#zz-img-show').append('<img style="max-width:230px;width:100%" src="' + res.data.url + '" />');$('textarea[name="comment"]').insertAtCaret('<img src="'+res.data.url+'" />')}})}});(function($){$.fn.extend({insertAtCaret:function(myValue){var $t=$(this)[0];if(document.selection){this.focus();sel=document.selection.createRange();sel.text=myValue;this.focus()}else if($t.selectionStart||$t.selectionStart=="0"){var startPos=$t.selectionStart;var endPos=$t.selectionEnd;var scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+myValue+$t.value.substring(endPos,$t.value.length);this.focus();$t.selectionStart=startPos+myValue.length;$t.selectionEnd=startPos+myValue.length;$t.scrollTop=scrollTop}else{this.value+=myValue;this.focus()}}})})(jQuery);
